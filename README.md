# Документация API для CV/Resume проекта

## Структура проекта

```text
├── controllers/
│   ├── contactController.js    # Контроллер для обратной связи
│   └── resumeController.js     # Контроллер для работы с резюме
├── routes/
│   ├── contactRoutes.js        # Маршруты для обратной связи
│   └── resumeRoutes.js         # Маршруты для резюме
└── config/
    └── database.js            # Конфигурация базы данных
```

---

## Контроллер: ContactController

**Файл:** `controllers/contactController.js`  
**Описание:** Контроллер для обработки запросов обратной связи (сообщений от компаний)

### Методы

#### `sendMeMessage(req, res)`

**Назначение:** Обрабатывает POST запрос на отправку сообщения от компании
**Маршрут:** `POST /api/contacts/send-message`
**Параметры запроса (body):**

```json
{
  "company_name": "Название компании",
  "email": "company@example.com",
  "message": "Текст сообщения"
}
```

**Валидация:**

- Все поля обязательны
- Email проверяется на корректность формата
- Данные очищаются от потенциально опасных символов

**Логика работы:**

1. Принимает и валидирует входные данные
2. Очищает данные от XSS-атак
3. Сохраняет сообщение в таблицу `feedback`
4. Возвращает ID созданной записи

**Ответ при успехе (201):**

```json
{
  "success": true,
  "message": "Сообщение успешно сохранено",
  "data": {
    "id": 123,
    "company_name": "Очищенное название",
    "email": "clean@example.com",
    "created_at": "2024-01-15T10:30:00.000Z"
  }
}
```

**Ошибки:**

- `400` - Невалидные данные (отсутствуют обязательные поля, некорректный email)
- `500` - Внутренняя ошибка сервера (ошибка базы данных)

---

## Контроллер: ResumeController

**Файл:** `controllers/resumeController.js`  
**Описание:** Контроллер для работы с данными резюме

### Методы

#### `getAllResumes(req, res)`

**Назначение:** Получает список всех резюме из базы данных
**Маршрут:** `GET /api/resumes`

**Параметры запроса:**

- Не требуется

**Логика работы:**

1. Выполняет SQL запрос для получения всех записей из таблицы `resume`
2. Возвращает массив резюме с пагинационной информацией

**Ответ при успехе (200):**

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "Иван Иванов",
      "position": "Frontend Developer",
      "experience": "5 лет",
      "skills": "JavaScript, React, TypeScript",
      "created_at": "2024-01-10T14:30:00.000Z"
    }
  ],
  "count": 1
}
```

**Ошибки:**

- `500` - Внутренняя ошибка сервера

#### `getResumeById(req, res)`

**Назначение:** Получает конкретное резюме по его ID
**Маршрут:** `GET /api/resumes/:id`

**Параметры запроса:**

- `id` (path parameter) - ID резюме (число)

**Валидация:**

- ID должен быть числом
- ID должен быть положительным числом

**Логика работы:**

1. Проверяет валидность ID
2. Ищет резюме в базе данных по ID
3. Если не найдено - возвращает 404
4. Если найдено - возвращает данные резюме

**Ответ при успехе (200):**

```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "Иван Иванов",
    "position": "Frontend Developer",
    "experience": "5 лет",
    "skills": "JavaScript, React, TypeScript",
    "created_at": "2024-01-10T14:30:00.000Z"
  }
}
```

**Ошибки:**

- `400` - Некорректный ID
- `404` - Резюме не найдено
- `500` - Внутренняя ошибка сервера

---

## Утилитарные функции

### `sanitizeInput(input)`

**Расположение:** `controllers/contactController.js` (или отдельный utils файл)
**Назначение:** Очищает входную строку от потенциально опасных символов

**Параметры:**

- `input` - Любое значение (обычно строка)

**Логика работы:**

1. Если входное значение не строка - возвращает как есть
2. Обрезает пробелы по краям
3. Удаляет символы `<` и `>` для защиты от XSS
4. Ограничивает длину строки 1000 символами

**Возвращает:** Очищенную строку

**Пример:**

```javascript
sanitizeInput("<script>alert('xss')</script>Test");
// Возвращает: "scriptalert('xss')/scriptTest"
```

### `validateEmail(email)`

**Расположение:** `controllers/contactController.js`
**Назначение:** Проверяет корректность формата email адреса

**Параметры:**

- `email` - Строка с email адресом

**Логика работы:**

1. Использует регулярное выражение для проверки формата
2. Проверяет наличие символа @ и доменной части

**Возвращает:** `true` если email валиден, `false` если нет

**Регулярное выражение:** `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`

---

## База данных

### Конфигурация (`config/database.js`)

**Singleton класс** для управления подключением к SQLite базе данных.

#### Методы:

- `connect(databasePath)` - Подключается к указанной базе данных
- `getDB()` - Возвращает текущее подключение к БД
- `close()` - Закрывает подключение к БД

### Таблицы

#### Таблица: `feedback`

```SQL
CREATE TABLE feedback (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    company_name TEXT NOT NULL,
    email TEXT NOT NULL,
    message TEXT NOT NULL,
)
```

**Назначение:** Хранение сообщений от компаний

**Поля:**

- `id` - Уникальный идентификатор (автоинкремент)
- `company_name` - Название компании (обязательное)
- `email` - Email для связи (обязательное)
- `message` - Текст сообщения (обязательное)

#### Таблица: `resume`

```SQL
CREATE TABLE resume (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    company_name TEXT,
    employment_date TEXT,
    dismissal_date TEXT,
    post TEXT,
    description TEXT,
)
```

**Назначение:** Хранение данных резюме

**Поля:**

- `id` - Уникальный идентификатор (автоинкремент)
- `company_name` - ФИО соискателя (обязательное)
- `employment_date` - Дата принятия
- `dismissal_date` - Дата увольнения
- `post` - Должность/позиция
- `description` - Описание должности

---


## Обработка ошибок

Все контроллеры используют единый формат ответа при ошибках:

```json
{
  "success": false,
  "error": "Описание ошибки"
}
```
### Коды статусов HTTP:

- `200` - Успешный запрос (GET)
- `201` - Успешное создание (POST)
- `400` - Неверные параметры запроса
- `404` - Ресурс не найден
- `500` - Внутренняя ошибка сервера

---

## Безопасность

### Защита от XSS:

- Все пользовательские данные очищаются функцией `sanitizeInput`
- Удаление символов `<` и `>` из строк

### Валидация данных:

- Проверка обязательных полей
- Валидация формата email
- Проверка типов данных (ID должен быть числом)

### Логирование:

- Все ошибки логируются в консоль
- Успешные операции также логируются для отладки